// Generated by CoffeeScript 1.7.1
(function() {
  var draw_stacked, fill_color, height, margin, marginRect, person1, person2, stacked_graph, width, x, y;

  person1 = 'anne-hidalgo';

  person2 = 'christiane-taubira';

  margin = {
    top: 60,
    right: 20,
    bottom: 60,
    left: 40
  };

  width = 1020;

  height = 355;

  fill_color = d3.scale.ordinal().range(["#a36556", "#4c223a", "#3c180a", "#e5cf3e", "#194276", "#35b1a7", "#2b9855"]);

  marginRect = 25;

  x = d3.scale.ordinal().rangeRoundBands([0, width]);

  y = d3.scale.linear().range([0, height]);

  stacked_graph = d3.select('body').append('svg').attr('width', width).attr('height', height).append('svg:g').attr('transform', 'translate(0,' + height + ')');

  draw_stacked = function(data_json) {
    var stacked_data, stacked_g, stacked_rect;
    stacked_data = d3.layout.stack()(data_json.channelMap.map(function(data_nd) {
      return data_json.channelDatas.map(function(d) {
        return {
          x: d.channelName,
          y: +d[data_nd]
        };
      });
    }));
    x.domain(stacked_data[0].map(function(d) {
      return d.x;
    }));
    y.domain([
      0, d3.max(stacked_data[stacked_data.length - 1], function(d) {
        return d.y0 + d.y;
      })
    ]);
    stacked_g = stacked_graph.selectAll('g').data(stacked_data).enter().append('g').attr('class', function(d, i) {
      return data_json.channelMap[i];
    }).attr('fill', function(d, i) {
      return fill_color(i);
    });
    return stacked_rect = stacked_g.selectAll('rect').data(Object).enter().append('rect').attr('x', function(d) {
      return x(d.x);
    }).attr('y', function(d) {
      return -y(d.y0) - y(d.y);
    }).attr('height', function(d) {
      return y(d.y);
    }).attr('width', x.rangeBand() - marginRect);
  };

  d3.json('person-' + person1 + "-" + person2 + '.json', function(error, data) {
    if (error) {
      return console.warn(error);
    }
    return draw_stacked(data);
  });

}).call(this);
